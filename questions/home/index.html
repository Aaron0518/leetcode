<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>克隆图 第一部分</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="Jekyll • Simple, blog-aware, static sites - Feed" href="/feed.xml" />
  <link rel="alternate" type="application/atom+xml" title="Recent commits to Jekyll’s master branch" href="https://github.com/mojombo/jekyll/commits/master.atom" />
  <link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Arizonia' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/normalize.css" />
  <link rel="stylesheet" href="/css/gridism.css" />
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/pygments.css" />
  <link rel="icon" type="image/x-icon" href="/favicon.png" />
  <script src="/js/modernizr-2.5.3.min.js"></script>
</head>


<body class="wrap">
  <header>
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li class="">
  <a href="/">首页</a>
  </li>
  <li class="current">
  <a href="/questions/home">题库</a>
  </li>
  <li class="">            
  <a href="/docs/home">文档</a>                              
  </li>
  <li class="">
  <a href="/news">新闻</a>
  </li>
  <li class="">
    <a href="https://github.com/xiangzhai/leetcode">GitHub</a>
  </li>
</ul>

  </nav>
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <h1>
        <a href="/">
          <span>LeetCode中文</span>
          <img src="/img/logo-2x.png" width="300px" height="63px" alt="">
        </a>
      </h1>
    </div>
    <nav class="main-nav unit two-thirds hide-on-mobiles">
      <ul>
  <li class="">
  <a href="/">首页</a>
  </li>
  <li class="current">
  <a href="/questions/home">题库</a>
  </li>
  <li class="">            
  <a href="/docs/home">文档</a>                              
  </li>
  <li class="">
  <a href="/news">新闻</a>
  </li>
  <li class="">
    <a href="https://github.com/xiangzhai/leetcode">GitHub</a>
  </li>
</ul>

    </nav>
  </div>
</header>


    <section class="questions">
    <div class="grid">

      <div class="unit four-fifths">
        <article>
          <h1>克隆图 第一部分</h1>
          <div class="note info">
    <p>克隆一个图。输入的是一个Node指针。返回值是被克隆的图的Node指针。</p>

    <p>一个图的结构体定义如下：</p>
    <div class="highlight"><pre><code class="cpp">    <span class="k">struct</span> <span class="n">Node</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="n">neighbors</span><span class="p">;</span>
    <span class="p">}</span>
    
</code></pre>
</div>

</div>

<div class="note">
    <p>有两种方法来遍历一个图。你还记得是哪<a href="http://zh.wikipedia.org/zh-cn/%E5%9B%BE%E9%81%8D%E5%8E%86" target="_blank">两种</a>吗？你能判断这个图是<a href="http://zh.wikipedia.org/zh-cn/%E5%9B%BE" target="_blank">有向图还是无向图</a>吗？</p>
</div>

<p><a href="http://leetcode.com/2012/05/clone-graph-part-i.html" target="_blank">leetcode.com提供的答案</a>：有两种方法来遍历一个图：广度优先、<a href="http://www.shendu.com" target="_blank">深度</a>优先。先尝试广度优先，需要一个队列。</p>

<p>广度优先的遍历是怎么鼓捣的？从队列里弹出一个节点，拷贝这个节点的全部邻居，再把这些邻居插入队列。</p>

<p>广度优先的遍历貌似可行。但是遗漏了某些细节。比如，我们如何连接克隆图的节点？</p>

<p>我们首先要确认图是否是有向的。如果你注意到Node是如何定义的，显而易见该图是有向图。为什么？</p>

<p>例如，A有个邻居B。那么，我们可以从A遍历到B。一个无向图意味着B可以遍历回到A。是真的吗？不，因为B是否能遍历回到A，取决于B有个邻居是A。</p>

<p>B可以遍历回到A意味着图可能包含一个环。必须谨慎处理这种情况。假如你完成了面试题但却忘了考虑这个情况，面试官随后就会指出你的代码中有一个死循环，讨厌～～～</p>

<p>举例分析如下：</p>

<img src="/img/simple_graph.png" alt="简单图">

<p>假设图的起点是A。首先，复制节点A(A2)，发现A只有一个邻居B。复制B(B2)，插入B2作为A2的邻居，连接了A2->B2。接下来，发现B有个邻居A，而A已经有个副本。这里，我们要注意不能再复制A，插入A2作为B2的邻居，连接B2->A2。但是，我们怎么知道一个节点已经被复制了呢？</p>

<p>简单，可以使用hash表！复制一个节点，就把它插入hash表。如果发现节点的某一个邻居已经在hash表里了，就不需要复制那个邻居，而是使用邻居的副本替代节点的副本。hash表存储key-value映射，key是原图里的节点，value是节点的副本。</p>

<div class="highlight"><pre><code class="cpp"><span class="k">typedef</span> <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">Node</span> <span class="o">*</span><span class="p">,</span> <span class="n">Node</span> <span class="o">*&gt;</span> <span class="n">Map</span><span class="p">;</span>
 
<span class="n">Node</span> <span class="o">*</span><span class="nf">clone</span><span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="n">graph</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">graph</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
 
    <span class="n">Map</span> <span class="n">map</span><span class="p">;</span>
    <span class="n">queue</span><span class="o">&lt;</span><span class="n">Node</span> <span class="o">*&gt;</span> <span class="n">q</span><span class="p">;</span>
    <span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">graph</span><span class="p">);</span>
 
    <span class="n">Node</span> <span class="o">*</span><span class="n">graphCopy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="p">();</span>
    <span class="n">map</span><span class="p">[</span><span class="n">graph</span><span class="p">]</span> <span class="o">=</span> <span class="n">graphCopy</span><span class="p">;</span>
 
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">Node</span> <span class="o">*</span><span class="n">node</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
        <span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">neighbors</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Node</span> <span class="o">*</span><span class="n">neighbor</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="c1">// 没有该副本</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">map</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">neighbor</span><span class="p">)</span> <span class="o">==</span> <span class="n">map</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">Node</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="p">();</span>
                <span class="n">map</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">neighbors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
                <span class="n">map</span><span class="p">[</span><span class="n">neighbor</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
                <span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">neighbor</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>     <span class="c1">// 副本已经存在</span>
                <span class="n">map</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">neighbors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">neighbor</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="k">return</span> <span class="n">graphCopy</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>


<div class="note info">                                                         
    <p>LeetCode.cn更希望提供真实的可编译运行的C++ 0x11<a href="https://raw.github.com/xiangzhai/leetcode/master/clonegraph/clonegraph.cpp" target="_blank">源代码</a></p>        
                                                                                
    <p>首先一个图的节点的结构体定义如下：</p>                                             
    <div class="highlight"><pre><code class="cpp">                                                         
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">graph_node</span>                                           
	<span class="p">{</span>                                                                               
	<span class="k">public</span><span class="o">:</span>                                                                         
    	<span class="n">graph_node</span><span class="p">()</span> <span class="p">{}</span>                                                             
    	<span class="n">graph_node</span><span class="p">(</span><span class="n">T</span> <span class="n">data</span><span class="p">)</span> <span class="o">:</span><span class="n">m_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{}</span>                                         
    	<span class="o">~</span><span class="n">graph_node</span><span class="p">()</span> <span class="p">{}</span>                                                            
                                                                                
	<span class="k">public</span><span class="o">:</span>                                                                         
    	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">graph_node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;*&gt;</span> <span class="n">neighbors</span><span class="p">;</span>                                      
    	<span class="n">T</span> <span class="nf">get_data</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_data</span><span class="p">;</span> <span class="p">}</span>                                             
                                                                                
	<span class="k">private</span><span class="o">:</span>                                                                        
    	<span class="n">T</span> <span class="n">m_data</span><span class="p">;</span>                                                                   
	<span class="p">};</span>                                                                          
    
</code></pre>
</div>
                                                          
</div>

<p>一个图的节点不仅包含结构std::vector<graph_node<T>*> neighbors；同时也需要包含数据T m_data。这里使用template<typename T>模板类来支持多种数据类型。我们会为graph_node取个别名：</p>
<div class="highlight"><pre><code class="cpp"><span class="k">typedef</span> <span class="n">graph_node</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">Node</span><span class="p">;</span>
</code></pre>
</div>


<p>LeetCode.com的原答案中没有考虑cleanup的事儿：</p>
<div class="highlight"><pre><code class="cpp"><span class="k">static</span> <span class="kt">void</span> <span class="nf">m_cleanup</span><span class="p">()</span>                                                         
<span class="p">{</span>                                                                               
    <span class="n">MapIter</span> <span class="n">iter</span><span class="p">;</span>                                                               
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>                                                                      
                                                                                
    <span class="k">for</span> <span class="p">(</span><span class="n">iter</span> <span class="o">=</span> <span class="n">map</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter</span> <span class="o">!=</span> <span class="n">map</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">iter</span><span class="o">++</span><span class="p">)</span>                         
    <span class="p">{</span>                                                                           
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">*</span><span class="n">iter</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">neighbors</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>                  
        <span class="p">{</span>                                                                       
            <span class="k">delete</span> <span class="p">(</span><span class="o">*</span><span class="n">iter</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>                                
            <span class="p">(</span><span class="o">*</span><span class="n">iter</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>                                
        <span class="p">}</span>                                                                       
    <span class="p">}</span>                                                                           
                                                                                
    <span class="k">if</span> <span class="p">(</span><span class="n">graphCopy</span><span class="p">)</span>                                                              
    <span class="p">{</span>                                                                           
        <span class="k">delete</span> <span class="n">graphCopy</span><span class="p">;</span>                                                       
        <span class="n">graphCopy</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>                                                       
    <span class="p">}</span>                                                                           
<span class="p">}</span>
</code></pre>
</div>


          <div class="section-nav">
  <div class="left align-right">
    
      <span class="prev disabled">返回</span>
    
  </div>
  <div class="right align-left">
    
    <a href="/questions/longest-palindromic-substring-part-ii" class="next">
        下一个
      </a>
    
  </div>
  <div class="clear"></div>
</div>


        </article>
      </div>

      <div class="clear"></div>

    </div>
  </section>


  <footer>
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <p>Copyright 2013 (C) <a href="mailto:xiangzhai83@gmail.com?subject=LeetCode中文">Zhai Xiang</a></p>
    </div>
    <div class="unit two-thirds align-right center-on-mobiles">
      <p>所有题库、答案、源代码遵循GPL V3 请轻轻地注明出处地转载</p>
    </div>
  </div>
</footer>

  
  <!-- Gauges (http://gaug.es/) -->
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '503c5af6613f5d0f19000027');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>





</body>
</html>
